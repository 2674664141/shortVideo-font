<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xingzhi.shortvideosharingplatform.mapper.UserMapper">
    <resultMap id="userInfoMap" type="com.xingzhi.shortvideosharingplatform.vo.UserInfoVO">
        <id property="id" column="id"/>
        <result property="userName" column="user_name"/>
        <result property="phone" column="phone"/>
        <result property="email" column="email"/>
        <result property="phoneVerified" column="phone_verified"/>
        <result property="emailVerified" column="email_verified"/>
        <result property="nickname" column="nickname"/>
        <result property="avatar" column="avatar"/>
        <result property="gender" column="gender"/>
        <result property="region" column="region"/>
        <result property="birthday" column="birthday"/>
        <result property="signature" column="signature"/>
        <result property="status" column="status"/>
        <result property="createdTime" column="created_time"/>
        <result property="updatedTime" column="updated_time"/>

        <association property="userProfile" javaType="com.xingzhi.shortvideosharingplatform.vo.UserProfileVO">
            <id property="id" column="up_id"/>
            <result property="userId" column="user_id"/>
            <result property="realName" column="real_name"/>
            <result property="idCard" column="id_card"/>
            <result property="isVerified" column="is_verified"/>
            <result property="verifyTime" column="verify_time"/>
            <result property="followerCount" column="follower_count"/>
            <result property="followingCount" column="following_count"/>
            <result property="videoCount" column="video_count"/>
            <result property="likeCount" column="like_count"/>
            <result property="viewCount" column="view_count"/>
            <result property="commentCount" column="comment_count"/>
            <result property="shareCount" column="share_count"/>
            <result property="level" column="level"/>
        </association>

        <association property="userPrivacy" javaType="com.xingzhi.shortvideosharingplatform.vo.UserPrivacyVO">
            <id property="id" column="uc_id"/>
            <result property="userId" column="uc_user_id"/>
            <result property="accountPublic" column="account_public"/>
            <result property="allowComment" column="allow_comment"/>
            <result property="allowMessage" column="allow_message"/>
            <result property="showViewHistory" column="show_view_history"/>
            <result property="allowDownload" column="allow_download"/>
        </association>
    </resultMap>
    <select id="selectUserInfoById" resultMap="userInfoMap">
        SELECT
        u.id,
        u.user_name,
        u.phone,
        u.email,
        u.phone_verified,
        u.email_verified,
        u.nickname,
        u.avatar,
        u.gender,
        u.region,
        u.birthday,
        u.signature,
        u.status,
        u.created_time,
        u.updated_time,
        up.id AS up_id,
        up.user_id,
        up.real_name,
        up.id_card,
        up.is_verified,
        up.verify_time,
        up.follower_count,
        up.following_count,
        up.video_count,
        up.like_count,
        up.view_count,
        up.comment_count,
        up.share_count,
        up.level,
        up.created_time AS up_created_time,
        up.updated_time AS up_updated_time,
        uc.id AS uc_id,
        uc.user_id AS uc_user_id,
        uc.account_public,
        uc.allow_comment,
        uc.allow_message,
        uc.show_view_history,
        uc.allow_download
        FROM users u
        LEFT JOIN user_profiles up ON u.id = up.user_id
        LEFT JOIN user_privacy uc ON u.id = uc.user_id
        WHERE u.id = #{userId}
    </select>
</mapper>